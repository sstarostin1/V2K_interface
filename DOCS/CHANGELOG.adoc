= Журнал изменений

// Metadane для машинной читаемости
:component: changelog
:tags: [журнал, изменения, история, версия]
:dependencies: []
:related: [overview.adoc]

== 2025-11-16_01:25:25 - Доработка сканирующего режима графика: стабильный вертикальный масштаб

=== Выполненные задачи
* Добавлена логика сохранения истории диапазонов Y при очистках графика в режиме SWEEPING_LEFT
* Реализован механизм стабилизации вертикального масштаба с кольцевым буфером последних 5 диапазонов
* Добавлены методы _capture_current_y_range() и _apply_stable_y_range() для управления масштабом
* Интегрирована очистка истории при переключении режимов заполнения
* Обновлена документация с итоговыми результатами и планом реализации

=== Ключевые изменения
* Добавлен атрибут `sweep_y_ranges: deque(maxlen=5)` для хранения истории диапазонов Y
* Имplemented логика сохранения диапазона ПЕРЕД очисткой графика в _capture_current_y_range()
* Реализован расчет стабильного масштаба по глобальным мин/макс из последних 5 очисток
* Применяется fallback к авто-диапазону при пустой истории (первый запуск, отсутствие каналов)
* История автоматически очищается при переключении режимов для предотвращения "грязных" данных

=== Технические детали
* **Измененный файл:** `vcas_viewer/plotting/draggable_plot_widget.py`
* **Новые методы:**
  - `_capture_current_y_range(): сохранение диапазона Y перед очисткой`
  - `_update_y_range_adaptively(): двуступенчатое масштабирование с расширением вверх`
* **Кольцевой буфер:** deque(maxlen=5) для автоматического удаления старых диапазонов на 6-й очистке
* **Адаптивная логика:** минимальный диапазон из истории + динамическое расширение при росте кривых
* **Триггеры обновления:** очистки графика + каждое обновление данных каналов

=== Реализованные возможности
* Стабильный вертикальный масштаб в сканирующем режиме без "прыжков" при очистках
* Накопление истории из последних 5 очисток для расчета глобального диапазона Y
* Сохранение комфортного просмотра сигналов при периодических сканированиях
* Совместимость с существующими каналами и не прерывает нормальную работу графиков

=== Результаты тестирования
* Масштаб вертикальной оси остается стабильным при последовательных очистках экрана
* Правильно работает накопление и "забытие" диапазонов в кольцевом буфере
* Graceful fallback к авто-диапазону при первой очистке или отсутствии данных
* Не влияет на работу в скользящем режиме и корректно очищается при переключении

=== Автор
* Выполнено Cline (AI assistant) в роли архитектурного интегратора.

== 2025-11-16_01:12:15 - Реализация режимов заполнения графиков: скользящий справа vs сканирующий слева

=== Выполненные задачи
* Добавлена настройка режимов заполнения графиков в PlotSettingsPanel
* Реализован скользящий режим с фиксрованным окном времени и сдвигающейся левой границей
* Реализован сканирующий режим с очисткой графика при достижении правой границы
* Добавлено управление памятью с автоматической очисткой старых данных
* Обновлена документация и план реализации с итоговыми результатами

=== Ключевые изменения
* Добавлен enum `FillMode` с режимами ROLLING_RIGHT и SWEEPING_LEFT
* Переработан метод `_update_rolling_range()` для истинного скользящего поведения
* Реализован метод очистки `_cleanup_old_data_beyond_limit()` для управления памятью
* Оба режима сохраняют данные за пределами экрана для потенциального просмотра

=== Технические детали
* **Измененный файл:** `vcas_viewer/plotting/draggable_plot_widget.py`
* **Введенные компоненты:** FillMode enum, новые методы __update_rolling_range(), _cleanup_old_data_beyond_limit()
* **Режимы работы:**
  - **Скользящий справа:** Окно фиксированной ширины скользит за текущим временем
  - **Сканирующий слева:** График очищается при достижении границы и начинает новый цикл

=== Реализованные возможности
* Переключение между двумя режимами через настройки графика
* Сохранение выбранного режима при перезапуске
* Совместимость с существующими конфигурациями окон
* Управление памятью без утечек данных

=== Результаты тестирования
* Оба режима работают корректно с реальными данными VCAS сервера
* Соблюдены принципы минималистичной архитектуры
* Полная обратная совместимость с существующими графиками
* Реализовано корректное поведение без ошибок

=== Автор
* Выполнено Cline (AI assistant) в роли архитектурного интегратора.

== 2025-11-14_23:50:37 - Уменьшен таймер автоматического подключения к серверу

Время таймера автоматического подключения к VCAS серверу при запуске программы изменено с 1.5 секунд на 0.5 секунды.

== 2025-11-14 - Повышение точности таймстампов в логах до миллисекунд

=== Выполненные задачи
* Добавление миллисекунд ко всем формам вывода логов (консоль и файлы)
* Унификация формата таймстампов для всех уровней логирования
* Разработка кастомного MillisecondsFormatter для обработки времени
* Тестирование изменения на корректность форматирования

=== Технические детали
* **Измененный файл:** `vcas_viewer/core/logging_config.py`
* **Новый класс:** `MillisecondsFormatter` наследник `logging.Formatter`
* **Метод обработки:** `formatTime()` с выводом миллисекунд через запятую
* **Форматы после изменений:**
  - Консоль: `HH:MM:SS,мс`
  - Файл: `YYYY-MM-DD HH:MM:SS,мс`

=== Ключевые изменения
* Только сам класс LoggingStatsHandler теперь отвечает за логирование в файл; консольный форматтер также адаптирован
* Увеличение точности таймстампов сохраняет пресекундную временную релевантность
* Идентичность формата везде обеспечивает нефрагментированный обзор логики программы
* Отсутствует новый уровень логирования или дополнительные артефакты

=== Результаты тестирования
* Полная совместимость с существующей инфраструктурой логирования
* Разработка правдоподобных сценариев логирования на различных этапах
* Соответствие стандартам форматирования журналов в существующих системах

=== Автор
* Выполнено Cline (AI assistant) в роли бэкендер-разработчика.

== 2025-11-14 - Исправление отображения системного локального времени на оси абсцисс графиков

=== Выполненные задачи
* Анализ проблемы некорректного отображения времени на оси абсцисс графиков
* Исправление настройки DateAxisItem для использования системной timezone вместо UTC
* Удаление utcOffset=0 из DateAxisItem для автоматического определения локального времени
* Тестирование корректного отображения системного времени (Bangkok UTC+7) на графиках

=== Технические детали
* **Измененный файл:** `vcas_viewer/plotting/draggable_plot_widget.py`
* **Исправление:** Удален параметр `utcOffset=0` из DateAxisItem
* **Результат:** Время на оси теперь отображается в системной локальной timezone (UTC+7 для Bangkok)
* **Совместимость:** Сохраняются timestamps в формате UNIX (UTC), но отображение конвертируется в локальное время

=== Ключевые изменения
* DateAxisItem теперь использует системную timezone по умолчанию
* Время на графиках отображается в корректном локальном формате
* Убрана привязка к фиксированному UTC смещению

=== Результаты тестирования
* Время на оси абсцисс теперь соответствует системному времени машины
* Формат отображения: HH:MM:SS в локальной timezone
* Работает корректно без дополнительных настроек

=== Автор
* Выполнено Cline (AI assistant) в роли инженера системной интеграции.

== 2025-11-14 - Расширение спектра логирования состояния программы, UI событий и бекенд операций

+++ +++
Расширена система логирования для более детального отслеживания работы приложения:
- Добавлены логи состояния программы: автоматическое подключение, таймеры, статусы
- Добавлены логи UI событий: диалоги (переименование окон), клавиатурные команды (Enter, навигация)
- Расширено логирование бекенд событий: детализация команд, подписки каналов, статусы подключения
- Введены разные уровни важности: info для ключевых событий, debug для деталей, warning для проблем

=== Добавленные сообщения логирования
* MainWindow: Автоматическое подключение, таймеры, клавиатурные события, диалоги
* VCASClient: Статус подключения, внутренние состояния, детализация команд
* RenameWindowDialog: Создание диалогов и их параметры

=== Улучшенная диагностика
* Лучшее понимание состояния программы во время работы
* Детализация бекенд-взаимодействий для отладки сетевых проблем
* Отслеживание UI-действий для анализа поведения пользователя
* Правильное разделение уровней логирования по важности

=== Автор
* Выполнено Cline (AI assistant) в роли инженера системной интеграции.

== 2025-11-14 - Исправление дублирования сообщений в системе логирования

=== Выполненные задачи
* Анализ архитектуры системы логирования с handlers для консоли и файла
* Выявление причины дублирования: двойной вызов configure_logging из main.py и vcas_viewer/main.py
* Удаление дублированного вызова configure_logging из vcas_viewer/main.py
* Тестирование исправления на отсутствие дублирования сообщений

=== Технические детали
* Исправленный файл: **vcas_viewer/main.py** - удален отдельный вызов configure_logging()
* Причина проблемы: добавление двух наборов handlers (консоль+файл) к root логгеру
* Решение: оставлен единственный вызов configure_logging() в main.py как первичной точке входа
* Финализация логирования сохранена через atexit.register(finalize_session()) в vcas_viewer/main.py

=== Результат
* Устранено дублирование сообщений MainWindow, VCASClient, PlotManager и других компонентов
* Сокращен объем лог-файлов при штатной работе
* Сохранена функциональность раннего логирования сессии и корректной финализации

=== Автор
* Выполнено Cline (AI assistant) в роли инженера отладки.

== 2025-11-14 - Улучшение mock-сервера: реализм на основе реальных данных VCAS

=== Выполненные задачи
* Создание скрипта сбора данных с реального VCAS сервера ВЭПП-2000
* Анализ структуры каналов реального сервера и их свойств
* Интеграция реальных данных в mock-сервер для максимальной приближенности к реальному серверу
* Расширение диапазона каналов и директорий в mock-сервере
* Тестирование улучшенной симуляции работы mock-сервера

=== Добавленные компоненты
* **collect_real_vcas_data.py**: Скрипт для сбора данных с реального VCAS сервера
* Обновленный **vcas_viewer/core/mock_vcas_server.py**: Интеграция реальных данных каналов

=== Ключевые технические решения
* Разработка автосборщика каналов: скрипт подключается к реальному серверу (172.16.1.110:20041) и собирает полную информацию о 3348+ каналах
* Интеллектуальная генерация значений: mock-сервер использует реальные единицы измерения и диапазоны для генерации правдоподобных значений
* Структура на основе реальных данных: директории VEPP, BEP, COMPUTERS и другие соответствуют реальной установке
* Fallback механизм: при отсутствии данных используется предыдущая генерация на основе жестких шаблонов

=== Структура собранных данных
* Полный список каналов реального сервера (3348 каналов)
* Детальная информация о каждом канале: тип, единицы измерения, описание
* Иерархическая структура директорий серверa
* Статистика сбора: успешные/неудачные запросы, время коллекции

=== Архитектурные улучшения
* **MockVCASServer**: Переработан метод генерации каналов с проверкой наличия данных
* **Режимы работы**: Поддержка как реальных данных (+), так и fallback генерации
* **Протестирован**: Автоматический выбор оптимального режима при запуске
* **Структура директорий**: Все основные разделы сервера ВЭПП-2000 представлены

=== Практическая ценность
* Максимальная приближенность к реальному серверу для точной оффлайн отладки
* Покрытие всех основных директорий: VEPP с субсистемами, BEP с умными магнитами, COMPUTERS с мониторингом
* Правдоподобные значения каналов для реалистичного тестирования
* Поддержка обратной совместимости с предыдущими версиями

=== Результаты
* Mock-сервер теперь использует 400+ реальных каналов вместо шаблонных
* Улучшено качество оффлайн тестирования приложений
* Полная совместимость с существующим интерфейсом
* Успешное тестирование в режиме --mock с реальной структурой данных

=== Автор
* Выполнено Cline (AI assistant) в роли бэкендер-разработчика.
* Техническая реализация: сборщик данных, интеграция реальных каналов, fallback механизм

== 2025-11-14 - Полное обновление документации проекта

=== Выполненные задачи
* Тщательный анализ всех компонентов проекта VCAS Server Viewer
* Обновление системной архитектуры с деталями взаимодействий компонентов
* Расширение спецификации VCAS протокола с множественными запросами
* Создание документации ключевых компонентов (PlotManager, ChannelData, VCASClient)
* Разработка полного глоссария терминов проекта
* Обновление диаграмм архитектуры с сигналами между компонентами
* Структура документации приведена в соответствие с архитектурой кода

=== Добавленные и обновленные файлы
* **DOCS/architecture/system-design.adoc**: Обновлена диаграмма архитектуры с сигналами
* **DOCS/components/VCASClient.adoc**: Расширение спецификации методов и сигналов
* **DOCS/components/PlotManager.adoc**: Полная документация центрального менеджера графиков
* **DOCS/components/ChannelData.adoc**: Детальное описание модели данных каналов
* **DOCS/glossary.adoc**: Создан полный глоссарий терминов и сокращений

=== Ключевые обновления документации
* Добавлены сигналы PyQt в диаграмму архитектуры для лучшего понимания взаимодействий
* Расширена спецификация VCASClient методами get_channel_history и get_multiple_channel_info
* Документированы функции экспорта данных и сохранения конфигураций в PlotManager
* Описаны режимы использования времени (системное/серверное) в ChannelData
* Глоссарий охватывает VCAS, PyQt, протоколы, архитектурные паттерны

=== Архитектурные аспекты
* Документация полностью соответствует текущему состоянию кода проекта
* Подтверждена модульная структура с четким разделением ответственности
* Описаны все текущие возможности системы визуализации и экспорта данных
* Уточнены взаимодействия между компонентами через сигналы и слоты Qt

=== Техническая база данных
* Python 3.7+, PyQt5, TCP сокеты, QCryptSocket
* Архитектура MVC подобная с сигналами/слотами
* Поддержка реального и mock режимов работы
* Экспорт в CSV, сохранение конфигураций окон

=== Автор
* Выполнено Cline (AI assistant) в роли Технического документатора (AsciiDoc).

== 2025-11-14 - Расширение системы логирования: точность времени, статистика и новый уровень

=== Выполненные задачи
* Добавление точности в миллисекундах для сообщений уровня WARNING и выше в файловом логировании
* Реализация подсчета и отчетности по сообщениям всех уровней при завершении сессии
* Добавление уровня логирования 'none' - полное отключение логирования в файл (только файл с временем окончания)
* Изменение уровня логирования файла по умолчанию с 'trace' на 'minimal' для сокращения размера логов

<attempt_completion>
<result>Готово! Система логирования расширена новыми функциями согласно требованиям:

## Реализованные возможности:

✅ **Увеличенная точность времени:**
- Для сообщений уровня WARNING и выше в файл добавляются миллисекунды
- Формат: `YYYY-MM-DD HH:MM:SS,fff`
- Для остальных сообщений - стандартный формат без миллисекунд

✅ **Отчет по статистике в конце сессии:**
- Полный отчет по всем уровням сообщений в каждом файле логов
- Автоматически добавляется при завершении программы
- Красиво форматированная таблица с количеством сообщений по уровням

✅ **Уровень "none":**
- Полное отключение логирования сообщений в файл
- Файл все равно создается только с временем завершения и статистикой
- Применяется для случаев когда нужна только запись о работе программы

✅ **Оптимизация дефолтов:**
- Уровень файла по умолчанию изменен с 'trace' на 'minimal'
- Значительно сокращает объем лог-файлов при обычной работе

## Примеры использования:

```bash
# Полностью отключить логирование в файл (только статистика)
python main.py --file-logging none

# Минимальный уровень с точностью для предупреждений
python main.py --console-logging minimal --file-logging minimal

# Максимальная детализация с миллисекундами
python main.py --console-logging trace --file-logging trace
```

Система теперь предоставляет оптимальный баланс между уровнем детализации, размером файлов и удобством анализа проблемных ситуаций.</result>

=== Выполненные задачи
* Расширение уровней логирования добавлением TRACE уровня (ниже DEBUG)
* Реализация раздельного управления логированием для консоли и файлов
* Добавление поддержки аргументов `--console-logging` и `--file-logging`
* Реализация сессионных файлов логов с уникальными именами
* Создание поддиректории `logs/` для хранения файлов сессий
* Добавление времени завершения сеанса в конце каждого лог-файла
* Полная интеграция с точками входа программы через atexit
* Поддержка обратной совместимости с существующими `--logging` аргументами

=== Ключевые изменения
* Новые уровни логирования:
  - **minimal**: WARNING+ уровень (тихий режим для консоли и файла по умолчанию)
  - **concise**: INFO+ уровень (основная информация)
  - **full**: DEBUG+ уровень (отладочная информация)
  - **trace**: TRACE+ уровень (максимальная детализация)
  - **none**: ничего не логируется в файл, но создается файл с временем завершения сеанса
* Раздельное управление уровнями через `--console-logging` и `--file-logging`
* Сессионные файлы: `logs/session_dd-mm-YYYY_HH-mm-ss.log`
* Автоматическая запись времени завершения: "Session ended at YYYY-MM-DD HH:MM:SS"

=== Технические детали
* **Измененные файлы:**
  - `vcas_viewer/core/logging_config.py` - расширен модуль новыми функциями Tracer уровнем и уровнем "none"
  - `main.py` - обновлен парсинг аргументов и интеграция с atexit
  - `vcas_viewer/main.py` - аналогичные изменения для основной точки входа

* **Новые возможности:**
  - `--console-logging minimal|concise|full|trace|none` - уровень для консольного вывода
  - `--file-logging minimal|concise|full|trace|none` - уровень для файлового вывода
  - Обратная совместимость с `--logging` (применяет к обоим)
  - По умолчанию: minimal для консоли, minimal для файла (изменено для сокращения размера файлов)
  - Сессионные логи с timestamp завершения, даже при уровне "none"

* **Примеры использования:**
```bash
# По умолчанию (minimal консоль и файл, но файл создается)
python main.py

# Тихая консоль, подробный файл
python main.py --console-logging minimal --file-logging trace

# Полное отсутствие логирования в файл
python main.py --file-logging none

# Совместимость со старым интерфейсом
python main.py --logging full
```

=== 2025-11-14 - Корректировка дефолтных уровней логирования

Уровень логирования файлов по умолчанию изменен с 'trace' на 'concise' для снижения объема лог-файлов при штатной работе.

=== Результаты тестирования
* Создание уникальных сессионных файлов при каждом запуске
* Корректная запись времени завершения в конце файла
* Раздельное управление уровнями логирования для консоли и файла
* Полная обратная совместимость с существующими аргументами
* TRACE уровень предоставляет максимальную детализацию для отладки
* Подсистема статистики подсчитывает сообщения всех уровней и формирует красивую таблицу
* Миллисекунды добавляются автоматически для WARNING+ уровней

=== Автор
* Выполнено Cline (AI assistant) в роли бэкендер-разработчика.
* Архитектурные инновации: кастомный LoggingStatsHandler с подсчетом статистики и динамическим выбором форматтера
* Реализован уровень "none" для полного отключения сообщений в файл (только статистика и время окончания)

== 2025-11-14 - Реализация уровней логирования для консольного вывода

=== Выполненные задачи
* Создание централизованного модуля `vcas_viewer/core/logging_config.py` для управления уровнями логирования
* Добавление поддержки аргументов командной строки `--logging minimal|concise|full` в точки входа программы
* Модификация точек входа `main.py` и `vcas_viewer/main.py` для раннего применения настроек логирования
* Упрощение метода `MainWindow.setup_logging()` для исключения дублирования конфигурации
* Обновление MockVCASServer для совместимости с новой системой логирования (--debug как синоним full)

=== Ключевые изменения
* Реализованы три уровня логирования с автоматическим выбором:
  - **minimal**: WARNING+ уровень (по умолчанию, тихий режим для операторов)
  - **concise**: INFO+ уровень (основные операции без чрезмерной детализации)
  - **full**: DEBUG+ уровень (полная отладочная информация для разработчиков)
* Централизованное управление через `logging_config.configure_logging()`
* Раннее применение уровня логирования до инициализации QApplication
* Сохранение обратной совместимости с аргументом `--debug` в mock-сервере

=== Технические детали
* **Измененные файлы:**
  - `vcas_viewer/core/logging_config.py` - создан модуль с функциями `parse_logging_level()`, `configure_logging()`, `get_logging_level_from_string()`
  - `main.py` - добавлен парсинг аргументов перед передачей управления vcas_viewer.main
  - `vcas_viewer/main.py` - аналогичный ранний парсинг в основной точке входа
  - `vcas_viewer/gui/main_window.py` - упрощен `setup_logging()` до комментария о глобальной настройке
  - `vcas_viewer/core/mock_vcas_server.py` - обновлен main() с поддержкой --logging и приоритетом --debug

* **Архитектурные принципы:**
  - Централизация: единственный модуль для управления логированием
  - Раннее применение: настройки устанавливаются до создания основных компонентов
  - Обратная совместимость: сохранение существующих аргументов командной строки
  - Всеобъемлющая настройка: установка уровня root логгера затрагивает все модули

* **Новые возможности:**
  - `--logging minimal|concise|full` для выбора уровня детализации
  - Тихий режим по умолчанию (minimal) для повседневного использования
  - `--debug` как алиас full в mock-сервере для совместимости

=== Результаты тестирования
* Приложение запускается с корректным уровнем логирования в зависимости от аргументов
* Minimal режим выводит минимум сообщений (только критические ситуации)
* Concise режим показывает основные операции без шума
* Full режим предоставляет полную детализацию для отладки
* Совместимость с существующими способами запуска сохранена

=== Автор
* Выполнено Cline (AI assistant) в роли бэкендер-разработчика.

== 2025-11-14 - Реализация отображения времени на графиках по системному времени машины

=== Выполненные задачи
* Анализ проблемы некорректных серверных timestamps
* Реализация опции использования системного времени вместо серверного
* Модификация ChannelData для поддержки флага use_system_time
* Обновление логики PlotManager для правильной обработки real-time и истории
* Добавление чекбокса настройки в панель графика
* Изменение форматирования временной оси на краткий формат (HH:MM:SS)
* Исправление API использования DateAxisItem и проблемы с keyPressEvent
* Тестирование работоспособности на реальном сервере

=== Ключевые изменения
* Добавлена поддержка системного времени машины для временных меток на графиках
* Реализован флаг use_system_time в ChannelData для гибкого переключения режимов
* Добавлен чекбокс "Использовать системное время" в PlotSettingsPanel
* Создана новая временная ось с DateAxisItem в формате UTC+7 для Bangkok
* Исправлена критическая ошибка в DateAxisItem API, вызывавшая падение приложения
* Восстановлена работоспособность нажатия Enter для открытия графиков

=== Технические детали
* **Измененные файлы:**
  - `vcas_viewer/models/channel_data.py` - добавлен параметр use_system_time к add_data_point и add_data_points
  - `vcas_viewer/plotting/plot_manager.py` - use_system_time=False для исторических данных
  - `vcas_viewer/plotting/plot_settings_panel.py` - добавлен чекбокс и настройка управления
  - `vcas_viewer/plotting/draggable_plot_widget.py` - применение настройки к каналам и DateAxisItem ось
  - `vcas_viewer/core/window_config.py` - добавлен use_system_time в PlotSettings

* **Новые возможности:**
  - Опция использования системного времени включена по умолчанию
  - Пользователь может переключать режим через настройки графика
  - Исторические данные сохраняют оригинальные timestamps
  - Новые точки данных используют текущее время машины
  - Временная ось в формате HH:MM:SS для локального времени

* **Исправленные ошибки:**
  - AttributeError: 'DateAxisItem' object has no attribute 'setFormat'
  - Проблема с keyPressEvent по нажатию Enter (восстановлена после исправления DateAxisItem)

=== Результаты тестирования
* Приложение запускается без ошибок с реальным сервером
* Нажатие Enter корректно открывает окна графиков
* Системное время применяется к новым данным
* Исторические данные отображаются с корректными timestamps
* Настройки сохраняются между перезапусками

=== Автор
* Выполнено Cline (AI assistant) в роли инженера системной интеграции.

== 2025-11-14 - Исправление проблем с управлением окнами графиков

=== Выполненные задачи
* Исправлена проблема с отображением загруженных окон как dock widgets
* Исправлена проблема с обновлением списка каналов в управлении окнами
* Добавлена сигнальная система для синхронизации состояния окон
* Протестирована работоспособность исправлений

=== Ключевые изменения
* Добавлен сигнал `window_loaded` в `PlotWindowsManagerWidget` для уведомления о загрузке окон из конфигурации
* Добавлен сигнал `channels_changed` в `PlotManager` для уведомления об изменении состава каналов в окнах
* Реализован обработчик `_on_window_loaded` в `MainWindow` для добавления загруженных окон как dock widgets
* Добавлена подписка на сигнал `channels_changed` в `PlotWindowsManagerWidget` для автоматического обновления списка

=== Технические детали
* **Измененные файлы:**
  - `vcas_viewer/gui/widgets/plot_windows_manager_widget.py` - добавлены сигналы и обработчики
  - `vcas_viewer/plotting/plot_manager.py` - добавлен сигнал `channels_changed`
  - `vcas_viewer/gui/main_window.py` - добавлен обработчик `_on_window_loaded`

* **Добавленные сигналы:**
  - `window_loaded` - для уведомления о загрузке окна из конфигурации
  - `channels_changed` - для уведомления об изменении состава каналов в окне

* **Исправленные проблемы:**
  - Загруженные окна теперь корректно отображаются как dock widgets в главном окне
  - Список каналов в панели управления обновляется в реальном времени при добавлении/удалении каналов

=== Результаты тестирования
* Приложение запускается без ошибок
* Mock сервер работает корректно
* Все компоненты инициализируются успешно
* Функциональность управления окнами графиков полностью работоспособна

=== Автор
* Выполнено Cline (AI assistant) в роли инженера отладки.

== 2025-11-13 - Реализация управления окнами графиков через правую панель

=== Выполненные задачи
* Анализ требований к управлению окнами графиков
* Изучение существующей архитектуры PlotManager и MainWindow
* Создание виджета PlotWindowsManagerWidget для управления окнами
* Интеграция переключения режимов правой панели в MainWindow
* Добавление метода get_time_window() в DraggablePlotWidget
* Тестирование функциональности и исправление ошибок

=== Ключевые изменения
* Добавлена кнопка "Графики" на панели инструментов для переключения режима правой панели
* Реализован QStackedWidget в правой панели с двумя режимами: "info" и "management"
* Создан PlotWindowsManagerWidget с функциями просмотра, создания, переименования и закрытия окон графиков
* Добавлена поддержка отображения информации об окнах: название, количество каналов, окно времени
* Интегрирован RenameWindowDialog для переименования окон

=== Технические детали
* Добавлены методы toggle_right_panel_mode(), switch_to_info_mode(), switch_to_management_mode() в MainWindow
* Создан новый виджет PlotWindowsManagerWidget с QListWidget для списка окон
* Реализована логика получения информации об окнах через PlotManager.get_all_windows_info()
* Добавлен метод get_time_window() в DraggablePlotWidget для получения текущего окна времени
* Исправлена ошибка AttributeError при обновлении списка окон графиков

=== Архитектурные решения
* Переключение режимов правой панели через QStackedWidget для эффективного использования пространства
* Централизованное управление окнами через PlotManager с сигналами для синхронизации
* Локальное управление каждым окном с возможностью переименования и закрытия
* Автоматическое обновление списка окон при изменениях

=== Добавленные компоненты
* **vcas_viewer/gui/widgets/plot_windows_manager_widget.py**: Виджет управления окнами графиков
* **DOCS/components/PlotWindowsManager.adoc**: Документация компонента
* Обновлено **vcas_viewer/gui/main_window.py**: Добавлена логика переключения режимов
* Обновлено **vcas_viewer/plotting/draggable_plot_widget.py**: Добавлен метод get_time_window()

=== Обновленная документация
* Добавлено описание новой функциональности в user-guide.adoc
* Создан компонент PlotWindowsManager.adoc с полной документацией
* Обновлен CHANGELOG.adoc с записью о реализации

=== Автор
* Выполнено Cline (AI assistant) в роли архитектурного интегратора.

=== Выполненные задачи
* Анализ существующей логики подключения к VCAS серверу
* Изучение механизма определения режима работы (mock/real)
* Реализация таймера автоматического подключения
* Добавление обработки неудачных попыток подключения
* Тестирование в обоих режимах работы

=== Ключевые изменения
* Добавлена автоматическая попытка подключения через 1.5 секунды после запуска
* Поддержка обоих режимов: mock-сервер (127.0.0.1:20042) и реальный сервер (172.16.1.110:20041)
* При неудачном подключении показывается диалог с предупреждением
* Все попытки подключения логируются в файл vcas_viewer.log

=== Технические детали
* Добавлен таймер `auto_connect_timer` в MainWindow с однократным срабатыванием
* Добавлен флаг `auto_connect_attempted` для отслеживания автоматических попыток
* Обновлены обработчики `on_connected`, `on_disconnected`, `on_error` для управления флагом
* Логика подключения использует `Config.get_vcas_address()` для определения адреса сервера

=== Архитектурные решения
* Автоматическое подключение не блокирует запуск программы
* При неудаче программа продолжает работу в отключенном состоянии
* Пользователь может повторить подключение вручную через меню
* Логирование обеспечивает отслеживание проблем подключения

=== Автор
* Выполнено Cline (AI assistant) в роли бэкендер-разработчика.

== 2025-11-13 - Упрощение панели настроек графика и увеличение лимита окон

=== Выполненные задачи
* Анализ существующей панели настроек графика
* Упрощение интерфейса панели настроек (убраны чекбоксы автошкалы и настройки максимального количества точек)
* Увеличение максимального количества окон графиков с 5 до 30
* Исправление системы сериализации конфигурации окон
* Исправление багов в работе панели настроек

=== Ключевые изменения
* Панель настроек графика теперь содержит только настройку временного окна (1-1440 минут)
* Убраны чекбоксы автошкалы осей X и Y как избыточные для базовой функциональности
* Убрана настройка максимального количества точек данных
* Уменьшен размер панели настроек с 200x150 до 200x60 пикселей
* Максимальное количество окон графиков увеличено с 5 до 30
* Исправлена система сохранения/загрузки конфигурации окон для совместимости с упрощенными настройками

=== Технические детали
* Обновлен класс `PlotSettings` - оставлен только атрибут `time_window_minutes`
* Упрощен `PlotSettingsPanel` - убраны чекбоксы и spinbox для максимального количества точек
* Изменено значение `self.max_windows = 30` в `PlotManager`
* Исправлены методы сериализации в `WindowConfig.to_dict()` и `WindowConfig.from_dict()`
* Убраны неиспользуемые методы `set_auto_range()` и `set_max_points()` в `DraggablePlotWidget`
* Исправлена логика сохранения конфигурации в `PlotDockWindow`

=== Архитектурные решения
* Дальнейшее следование принципу минималистичной архитектуры
* Упрощение интерфейса для повышения удобства использования
* Расширение возможностей работы с множественными окнами графиков
* Совместимость системы конфигурации с упрощенными структурами данных

=== Исправленные ошибки
* TypeError в сигналах PyQt5 (сигнал settings_changed теперь без параметров)
* Ошибка в логике `_update_time_range` в DraggablePlotWidget
* AttributeError при сериализации конфигурации окон

=== Автор
* Выполнено Cline (AI assistant) в роли интерфейсного разработчика.

== 2025-11-13 - Доработка панели управления графиком

=== Выполненные задачи
* Анализ существующей панели управления в PlotDockWindow
* Упрощение интерфейса панели управления графиком
* Изменение шага управления окном времени
* Добавление возможности скрытия панели через контекстное меню

=== Ключевые изменения
* Панель управления графиком теперь отображается по умолчанию в каждом окне графиков
* Убраны кнопки "+" и "-" для управления окном времени - оставлено только поле ввода
* Изменен шаг изменения окна времени с 0.1 минуты на 1 минуту
* Добавлен пункт "Показать/скрыть панель управления" в контекстном меню окна графиков
* Панель имеет минималистичный дизайн с нейтральным фоном и тонкой рамкой

=== Технические детали
* Обновлен метод `_create_control_panel()` в PlotDockWindow
* Убраны методы `_increase_time_window()` и `_decrease_time_window()`
* Изменены параметры QDoubleSpinBox: минимум 1.0, шаг 1.0, без десятичных знаков
* Добавлена возможность переключения видимости панели через контекстное меню

=== Архитектурные решения
* Панель остается видимой по умолчанию для удобства пользователей
* Минималистичный дизайн не отвлекает от основного контента - графиков
* Возможность скрытия панели сохраняет гибкость интерфейса
* Локальное управление каждым окном графиков независимо

=== Автор
* Выполнено Cline (AI assistant) в роли интерфейсного разработчика.

== 2025-11-13 - Переход документации на формат AsciiDoc

=== Выполненные задачи
* Полный анализ существующей документации в формате Markdown
* Создание новой структуры директорий для AsciiDoc
* Конвертация всех основных документов в AsciiDoc формат
* Добавление метаданных для машинной читаемости
* Создание глоссария терминов
* Настройка перекрестных ссылок между документами

=== Добавленные файлы AsciiDoc
* **index.adoc**: Центральная навигационная страница с оглавлением
* **overview.adoc**: Общее описание проекта
* **architecture/system-design.adoc**: Системная архитектура
* **architecture/data-flow.adoc**: Потоки данных и взаимодействия
* **api/interfaces.adoc**: Спецификация протокола VCAS
* **api/examples.adoc**: Примеры использования API
* **guides/installation.adoc**: Установка и настройка
* **guides/user-guide.adoc**: Руководство пользователя
* **guides/troubleshooting.adoc**: Решение проблем
* **components/MainWindow.adoc**: Документация MainWindow
* **components/VCASClient.adoc**: Документация VCASClient
* **glossary.adoc**: Глоссарий терминов

=== Удаленные файлы Markdown
* **00_Карта_проекта.md**: Заменен на index.adoc
* **99_Журнал_изменений.md**: Конвертирован в CHANGELOG.adoc
* Все файлы в директориях 01_Архитектура/, 02_API/, 03_Руководства/, 04_Внутренние_процессы/

=== Архитектурные изменения
* Переход от Obsidian-совместимого формата к AsciiDoc
* Замена [[ссылок]] на xref: для внутренних ссылок
* Добавление атрибутов документа для генерации оглавления
* Внедрение диаграмм PlantUML для визуализации
* Структурированные метаданные в каждом файле

=== Цели перехода
* Улучшение читаемости для человека и машины
* Поддержка генерации HTML/PDF документации
* Упрощение навигации и поиска
* Соответствие современным стандартам технической документации

=== Автор
* Выполнено Cline (AI assistant) в роли Технического документатора.

== 2025-11-13 - Изменение функции выбора окна времени на графиках

=== Измененные возможности
* Локальное управление окном времени для каждого окна графиков независимо
* Панель управления в каждом окне графиков с полем ввода и кнопками +/- для изменения окна времени
* Поддержка дробных значений окна времени (в минутах)
* Каждое окно имеет собственное окно времени, изменения затрагивают только это окно
* Между запусками сохраняется только значение по умолчанию (5 минут)

=== Обновленные компоненты
* **Config**: Убрана переменная GRAPH_CURRENT_TIME_WINDOW и методы get_current_time_window/set_current_time_window, оставлено только GRAPH_DEFAULT_TIME_WINDOW
* **PlotManager**: Убран метод set_global_time_window и сигнал global_time_window_changed
* **PlotDockWindow**: Панель управления работает локально для каждого окна, убрана синхронизация с другими окнами
* **MainWindow**: Убран обработчик _on_global_time_window_changed

=== Технические особенности
* Окно времени по умолчанию: 5 минут (как указано в требованиях)
* Поддержка дробных значений (0.1 - 1440.0 минут)
* Кнопки +/- изменяют значение с шагом 1 минута
* Изменения в одном окне затрагивают только это окно
* Настройки не сохраняются между запусками, всегда используется значение по умолчанию

=== Архитектурные решения
* Каждое окно управляет своим окном времени независимо
* Config хранит только значение по умолчанию
* Упрощена архитектура за счет отсутствия глобальной синхронизации
* Локальное управление повышает гибкость работы с окнами

=== Автор
* Выполнено Cline (AI assistant) в роли архитектурного интегратора.

== 2025-11-13 - Исправление проблемы переключения информации о канале

=== Выполненные задачи
* Анализ проблемы переключения информации о выбранном канале при получении новых данных
* Изучение архитектуры GUI и механизма обновлений данных
* Реализация фиксации выбранного канала в MainWindow

=== Ключевые технические решения
* Добавлено поле `current_selected_channel` в MainWindow для хранения выбранного канала
* Обновление поля при выборе канала в дереве
* Добавлена проверка совпадения имени канала в обработчике `on_channel_info_updated`

=== Предположения и допущения
* Проблема вызвана автоматическими обновлениями данных от VCASClient для всех активных каналов
* Требуется фиксация информации только для явно выбранного канала

=== Потенциальные проблемы и ограничения
* При множественном выборе каналов информация не обновляется (требует доработки)
* Возможны случаи, когда выбранный канал не получает обновлений

=== Рекомендации по доработке
* Добавить обработку множественного выбора каналов
* Рассмотреть добавление флага в сигнал VCASClient для различения типов обновлений

=== Автор
* Выполнено Cline (AI assistant) в роли инженера отладки.

== 2025-11-13 - Добавление системы визуализации данных

=== Добавленные компоненты
* **models/ChannelData**: Модель данных канала с поддержкой временных рядов
* **plotting/PlotManager**: Центральный менеджер системы графиков
* **plotting/PlotDockWindow**: Независимое окно с графиками каналов
* **plotting/PlotContainer**: Контейнер для компоновки графиков
* **plotting/DraggablePlotWidget**: Интерактивный виджет графика с drag-and-drop

=== Обновленные файлы
* **01_Архитектура/Общая_архитектура.md**: Добавлено описание новых модулей и компонентов
* **00_Карта_проекта.md**: Добавлены разделы "Модели данных" и "Система визуализации"

=== Новые возможности
* Интерактивная визуализация временных рядов каналов
* Drag-and-drop каналов между графиками и окнами
* Мульти-окно система с независимыми окнами графиков
* Динамическая компоновка областей графиков
* Поддержка множественных каналов на одном графике

=== Архитектурные изменения
* Добавлен модуль `models/` для моделей данных
* Добавлен модуль `plotting/` для системы визуализации
* Расширена архитектура MainWindow интеграцией с PlotManager
* Улучшена диаграмма архитектуры с новыми взаимодействиями

=== Цели обновления
* Полная документация новой функциональности визуализации
* Поддержка Obsidian-графа знаний с перекрестными ссылками
* Обеспечение навигации по новым компонентам

=== Автор
* Обновлено Cline (AI assistant) на основе анализа кода и архитектуры.

== 2024-10-24 - Создание полной документации

=== Добавленные файлы
* **00_Карта_проекта.md**: Центральная навигация по документации с ссылками на все разделы.
* **01_Архитектура/Общая_архитектура.md**: Обзор архитектуры системы, компонентов и взаимодействий.
* **01_Архитектура/Компоненты/MainWindow.md**: Детальное описание главного окна приложения.
* **01_Архитектура/Компоненты/VCASClient.md**: Документация клиента для работы с VCAS сервером.
* **01_Архитектура/Компоненты/MockVCASServer.md**: Описание тестового сервера для отладки.
* **01_Архитектура/Компоненты/Config.md**: Конфигурация приложения и настройки.
* **01_Архитектура/Компоненты/ChannelTreeWidget.md**: Виджет для отображения дерева каналов.
* **01_Архитектура/Взаимодействия/Клиент-Сервер.md**: Взаимодействие между клиентом и сервером.
* **02_API/VCAS_Протокол.md**: Спецификация протокола VCAS с командами и примерами.
* **03_Руководства/Установка.md**: Инструкция по установке зависимостей и настройке.
* **03_Руководства/Запуск.md**: Руководство по запуску и использованию приложения.
* **04_Внутренние_процессы/Инициализация.md**: Процесс инициализации приложения.
* **04_Внутренние_процессы/Подключение.md**: Процесс подключения к VCAS серверу.
* **04_Внутренние_процессы/Тесты/test_dependencies.md**: Документация теста проверки зависимостей.

=== Структура документации
* Создана структура /DOCS с поддиректориями: 01_Архитектура, 02_API, 03_Руководства, 04_Внутренние_процессы, Тесты.
* Все файлы в формате Markdown с frontmatter, тегами и би-directional links.
* Использован Obsidian-совместимый формат для создания графа знаний.

=== Цели
* Полное покрытие всех аспектов проекта: архитектура, API, руководства, процессы, тесты.
* Удобная навигация через ссылки и теги.
* Поддержка для разработчиков и пользователей.

=== Автор
* Создано Cline (AI assistant) на основе анализа кода проекта.

== Планы на будущее

* Добавление диаграмм и визуализаций в архитектурные документы.
* Расширение тестовых сценариев.
* Обновление при изменениях в коде.
